# scraper
scraper of yandex maps

## Инструкция

1. Определяем название файла для сохранения данных:

    - находим строку, которая начинается на "df.to_csv" (415 строка, функция scrape)
    - меняем "output.csv" на название таблицы

2. Определяем минимальное количество организаций, которые ищем за один запрос:

    - находим строку, которая начинается на "if total_orgs < 10:" (372 строка, функция scrape)
    - меняем число на то минимальное количество организаций, которые хотели бы увидеть за один запрос
    - добавляем число в строку "Организаций меньше 10. Попытка {attempt} из {max_retries}. Перезапуск..."

3. Определяем текст запроса и метку, по которой будут определяться организации, найденные по запросу:

    - находим строку, где определяется переменная queries (441 строка)
    - в список прописываем кортеж, где первый элемент - запрос, второй - метка, например: ("pims Москва", "moscow_pims")

4. Запуск парсера:

    - переходим в терминал, в терминале заходим в директорию с парсером (cd scraper)
    - так же, через терминал, запускаем парсер командой: python3 scraper.py
    - после того, как скрипт отработает, в директории появится файл с названием, которое мы определили в пункте 1 

5. Обработка полученных данных

    - переходим в файл jupyter notebook (scraper.ipynb)
    - запускаем локальную spark-сессию в первой ячейке (запускаем первую ячейку)
    - читаем полученный файл                
            (table_from_file = spark.read.csv('файл.csv', header=True)
    - обрабатываем данные
             filtered_table = table_from_file.select('column1', 'column2').orderBy('column3')
    - сохраняем результат                              
             filtered_table.toPandas().to_csv('filtered_table.csv', index=False))